<div style="margin: 5px 0; padding: 5px; background-color: #fafafa; border: 1px solid #ccc; border-radius: 8px; box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);">
    <!-- توسيط العنوان بمساحة صغيرة -->
    <div style="display: flex; justify-content: center; align-items: center; font-size: 14px; font-weight: bold; padding: 2px; margin-bottom: 2px; background-color: #e9ecef; border-radius: 4px;">
        بيانات المشتري
    </div>

    <table style="width: 100%; border-collapse: collapse; direction: rtl;">
        <tbody>

            <!-- استخراج اسم المشتري -->
            <tr>
                <th style="text-align: right; padding: 5px; border: 1px solid #ccc; background-color: #e9ecef; font-weight: bold;">الإسم</th>
                <td style="text-align: center; padding: 5px; border: 1px solid #ccc;">{{ doc.customer_name }}</td>
            </tr>

            <!-- استخراج رقم الهاتف -->
            {% set address_name = frappe.db.get_value("Dynamic Link", {"link_doctype": "Customer", "link_name": doc.customer}, "parent") %}
            {% set phone = frappe.db.get_value("Address", address_name, "phone") if address_name else "" %}
            {% if phone %}
            <tr>
                <th style="text-align: right; padding: 5px; border: 1px solid #ccc; background-color: #e9ecef; font-weight: bold;">الهاتف</th>
                <td style="text-align: center; padding: 5px; border: 1px solid #ccc;">{{ phone }}</td>
            </tr>
            {% endif %}

            <!-- استخراج عنوان المشتري -->
            {% set address_name = frappe.db.get_value("Dynamic Link", {"link_doctype": "Customer", "link_name": doc.customer}, "parent") %}
            {% set address_line1, city, pincode = frappe.db.get_value("Address", address_name, ["address_line1", "city", "pincode"]) if address_name else ("", "", "") %}
            {% if address_line1 or city or pincode %}

            <!-- عرض عنوان المشتري -->
            <tr>
                <th style="text-align: right; padding: 5px; border: 1px solid #ccc; background-color: #e9ecef; font-weight: bold;">العنوان</th>
                <td style="text-align: center; padding: 5px; border: 1px solid #ccc;">
                    {{ address_line1 if address_line1 else '' }}
                    {% if city %}, {{ city }}{% endif %}
                    {% if pincode %}, {{ pincode }}{% endif %}
                </td>
            </tr>
            {% endif %}

            <!-- الرقم الضريبي -->
            {% set custom_vat_registration_number = frappe.db.get_value('Customer', doc.customer, 'custom_vat_registration_number') or '' %}
            {% if custom_vat_registration_number %}
            <tr>
                <th style="text-align: right; padding: 5px; border: 1px solid #ccc; background-color: #e9ecef; font-weight: bold;">الرقم الضريبي</th>
                <td style="text-align: center; padding: 5px; border: 1px solid #ccc;">{{ custom_vat_registration_number }}</td>
            </tr>
            {% endif %}

            <!-- السجل التجاري -->
            {% set customer_commercial_reg_no = frappe.db.get_value("Additional Buyer IDs", {"parent": doc.customer, "type_name": "Commercial Registration Number"}, "value") %}
            {% if customer_commercial_reg_no %}
            <tr>
                <th style="text-align: right; padding: 5px; border: 1px solid #ccc; background-color: #e9ecef; font-weight: bold;">السجل التجاري</th>
                <td style="text-align: center; padding: 5px; border: 1px solid #ccc;">{{ customer_commercial_reg_no }}</td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</div>
